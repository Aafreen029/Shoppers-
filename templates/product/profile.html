{% extends "base.html" %}
{% load static %}
{% block body %}
<section class="section-content padding-y bg">
  <div class="container">
    <div class="row">

      <!-- Sidebar -->
      <aside class="col-md-3 text-center mb-3">
       

        <ul class="list-group">
          <li class="list-group-item"> 
            {% if address.profile_picture and address.profile_picture.url  %}
          <img src="{{ address.profile_picture.url }}" class="rounded-circle mb-2" style="width: 30px; height: 30px;">
        {% else %}
          <img src="/media/profile_pics/default_profile.png" class="rounded-circle mb-2" style="width: 30px; height: 30px;">
        {% endif %}
            Hi  {{ address.first_name }} {{ address.last_name }}</li>
          <a class="list-group-item {% if request.resolver_match.url_name == 'profile' %}active{% endif %}" href="{% url 'profile' %}"><i class='fas fa-camera'></i> My Profile</a>
          <a class="list-group-item" href="{% url 'order' %}"><i class="fa-solid fa-shopping-bag"></i> My Orders</a>
          <a class="list-group-item" href="{% url 'address' %}"><i class="fa fa-address-card" aria-hidden="true"></i> Manage Address</a>
        </ul>
      </aside>

      <!-- Main Content -->
      <div class="col-md-9">
        <div class="card">
          <div class="card-body">

            {% if not profile_exists or edit_mode %}
              <h5 class="mb-4">
                {% if not profile_exists %}Create Profile{% else %}Edit Profile{% endif %}
              </h5>

              <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                
                <!-- Profile Picture Upload -->
                <div class="form-group row mt-3">
                  <div class="col">
                    <label>Profile Picture</label>
                    <input type="file" name="profile_picture" class="form-control mb-2">
                    {% if address.profile_picture and address.profile_picture.url %}
                    <img src="{{ address.profile_picture.url }}" class="mt-2 rounded" style="width: 90px; height: 90px;"><br>
                    <input type="checkbox" name="remove_profile_picture" id="remove_pp">
                    <label for="remove_pp">Remove current picture</label>
                    {% endif %}
                  </div>
                </div>
                <div class="form-group row mt-3">
                  <div class="col">
                    <label>First Name</label>
                    <input type="text" name="first_name" class="form-control" required value="{{ address.first_name|default_if_none:'' }}">
                  </div>
                  <div class="col">
                    <label>Last Name</label>
                    <input type="text" name="last_name" class="form-control" required value="{{ address.last_name|default_if_none:'' }}">
                  </div>
                </div>

                <div class="form-group mt-3">
                  <label class="d-block">Gender</label>
                  <div class="d-flex gap-3">
                    {% for g in gender_choices %}
                      <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="gender" id="gender_{{ g }}" value="{{ g }}"
                               {% if address.gender == g %}checked{% endif %}>
                        <label class="form-check-label" for="gender_{{ g }}">{{ g|capfirst }}</label>
                      </div>
                    {% endfor %}
                  </div>
                </div>

                <div class="form-group row mt-3">
                  <div class="col">
                    <label>Email</label>
                    <input type="email" name="email" class="form-control" required value="{{ address.email|default_if_none:'' }}">
                  </div>
                  <div class="col">
                    <label>Phone</label>
                    <input type="text" name="phone" class="form-control" required value="{{ address.phone|default_if_none:'' }}">
                  </div>
                </div>

                <div class="mt-4 d-flex justify-content-end">
                  <button type="submit" class="btn btn-outline-success">
                    {% if not profile_exists %}Save{% else %}Update{% endif %}
                  </button>
                </div>
              </form>

            {% else %}
              <!-- Show Profile Info -->
              <h5 class="mb-4">Personal Information</h5>

              {% if address.profile_picture %}
                <img src="{{ address.profile_picture.url }}" class="rounded-circle mb-3" style="width: 90px; height: 90px;">
              {% endif %}

              <p><strong>Name:</strong> {{ address.first_name }} {{ address.last_name }}</p>
              <p><strong>Gender:</strong> {{ address.gender }}</p>
              <p><strong>Email:</strong> {{ address.email }}</p>
              <p><strong>Phone:</strong> {{ address.phone }}</p>

              <form method="post" class="d-flex justify-content-end">
                {% csrf_token %}
                <input type="hidden" name="edit_profile" value="true">
                <button type="submit" class="btn btn-warning btn-sm">Edit Profile</button>
              </form>
            {% endif %}

          </div>
        </div>
      </div>

    </div>
  </div>
</section>
{% endblock %}
