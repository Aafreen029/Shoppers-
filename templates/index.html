{% extends "base.html" %}
{% load static %}
{% block body %}

<!--  Horizontal Category Strip with Conditional Dropdown -->
<style>
  .category-tile {
    position: relative;
    min-width: 100px;
    text-align: center;
  }
  .category-tile img {
    width: 60px;
    height: 60px;
    object-fit: contain;
    border-radius: 50%;
    background-color: #f8f9fa;
    padding: 8px;
  }
  .subcategory-dropdown {
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    background-color: white;
    border: 1px solid #ddd;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    z-index: 1000;
    display: none;
    min-width: 150px;
  }
  .category-tile:hover .subcategory-dropdown {
    display: block;
  }
  .subcategory-dropdown a {
    display: block;
    padding: 8px 12px;
    text-decoration: none;
    color: #333;
    white-space: nowrap;
  }
  .subcategory-dropdown a:hover {
    background-color: #f8f9fa;
  }
</style>
<div class="container bg-dark py-1 border-bottom">
  <div class="d-flex flex-wrap gap-4 justify-content-center align-items-center">
    {% for cat in categories %}
      <div class="category-tile">
        <a href="{% url 'category_products' cat.slug %}" class="text-decoration-none text-white">
          <div class="d-flex flex-column align-items-center">
            <div class="rounded-circle bg-light d-flex justify-content-center align-items-center mb-2" style="width: 60px; height: 60px;">
              {% if cat.cat_image %}
                <img src="{{ cat.cat_image.url }}" alt="{{ cat.category_name }}">
              {% else %}
                <img src="{% static 'images/default-category.png' %}" alt="Default">
              {% endif %}
            </div>
            <small class="fw-semibold">{{ cat.category_name }}</small>
          </div>
        </a>
        {% if cat.subcategories.all %}
        <div class="subcategory-dropdown">
          {% for sub in cat.subcategories.all %}
            <a href="{% url 'subcategory_products' sub.slug %}">{{ sub.subcategory_name }}</a>
          {% endfor %}
        </div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>

<!-- Bootstrap Carousel -->
<div id="homeCarousel" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#homeCarousel" data-bs-slide-to="0" class="active"></button>
    <button type="button" data-bs-target="#homeCarousel" data-bs-slide-to="1"></button>
    <button type="button" data-bs-target="#homeCarousel" data-bs-slide-to="2"></button>
  </div>
  <div class="carousel-inner" style="  height: 350px" >
    <div class="carousel-item active">
      <img src="media/upload/ecomupt2.png" class="d-block w-100" alt="Slide 1" style="  object-fit: contain; height: 100%">
    </div>
  <div class="carousel-item">
    <img src="media/upload/men.png" class="d-block w-100" alt="Slide 2" style=" object-fit: contain;height: 100%">
  </div>
  <div class="carousel-item">
    <img src="media/upload/ecomupt3.png" class="d-block w-100" alt="Slide 3"style=" object-fit: contain;height: 100%" >
  </div>
</div>
<button class="carousel-control-prev" type="button" data-bs-target="#homeCarousel" data-bs-slide="prev">
  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
  <span class="visually-hidden">Previous</span>
</button>
  <button class="carousel-control-next" type="button" data-bs-target="#homeCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

  <!-- Section: Products by Category -->
  <section class="py-2">
  <div class="container px-2 px-lg-5 mt-5">
    {% for cat, products in products_by_category.items %}
      <h3 class="mb-4" style="border-bottom: 1px solid #ccc;">{{ cat.category_name }}</h3>
      <div id="carousel{{ forloop.counter }}" class="carousel slide mb-5" data-bs-ride="carousel" data-bs-interval="2000">
        <div class="carousel-inner">
          {% for product in products %}
            {% if forloop.first or forloop.counter0|divisibleby:4 %}
            <div class="carousel-item {% if forloop.first %}active{% endif %}">
              <div class="d-flex justify-content-between gap-3">
            {% endif %}

                <div class="card" style="width: 23%;">
                  <a href="{% url 'product_details' product.slug %}" style="text-decoration: none; color: inherit;">
                    <div class="image-wrapper" style="height: 220px; background-color: #f8f9fa; display: flex; align-items: center; justify-content: center;">
  {% if product.thumbnail %}
    <img src="{{ product.thumbnail.url }}"
         alt="{{ product.product_name }}"
         style="max-height: 100%; max-width: 100%; object-fit: contain;">
  {% else %}
    <span class="text-muted">No Image</span>
  {% endif %}
</div>

                    <div class="card-body">
                      <h6 class="fw-bold">{{ product.product_name }}</h6>
                      {% if product.discount_price %}
                        <p>
                          <span class="text-muted text-decoration-line-through">&#8377;{{ product.product_price }}</span>
                          <span class="text-success">&#8377;{{ product.discount_price }}</span>
                        </p>
                      {% else %}
                        <p class="text-dark">&#8377;{{ product.product_price }}</p>
                      {% endif %}
                    </div>
                  </a>
                </div>

            {% if forloop.counter|divisibleby:4 or forloop.last %}
              </div>
            </div>
            {% endif %}
          {% endfor %}
        </div>

        <!-- Carousel controls -->
        <button class="carousel-control-prev" type="button" data-bs-target="#carousel{{ forloop.counter }}" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#carousel{{ forloop.counter }}" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
      </div>
    {% empty %}
      <p>No products available.</p>
    {% endfor %}
  </div>
</section>
 <!--section class="py-5">
            <div class="container px-4 px-lg-5 mt-5">
              
                <div class="row gx-4 gx-lg-5 row-cols-2 row-cols-md-3 row-cols-xl-4 justify-content-center">
                  {% for Post in page_obj %}
                    <div class="col mb-5">
                        <div class="card h-100">
                            <!-- Product image>
                            <a href="{% url 'blog_post' Post.title %}" style="text-decoration:none;">
                            {% if Post.thumbnail %}
                            <img class="card-img-top" src={{ Post.thumbnail.url }} alt=""style=" height:250px;" />
                            {% else %}
                             <div class="bd-placeholder-img bg-light d-flex align-items-center justify-content-center" >
                              <span class="text-muted">No Image</span>
                            </div>
                            {% endif %}
                            <!-- Product details>
                            <div class="card-body p-4">
                                <div class="text-center">
                                    <!-- Product name>
                                    <h5 class="fw-bolder"  style="color:black;">{{ Post.title }}</h5>
                                    <!-- Product description>
                                    <h5 class="card-text-small" style="font-size: 15px;">{{ Post.description |truncatechars:50 }}</h5>
                                </div>
                                <div class="d-flex gap-2">
                                  <a href="{% url 'blog_post' Post.title %}" class="btn btn-sm btn-dark mb-1">VIEW</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
            </div>
        </section-->
        <div class="pagination-area">
  <nav aria-label="Page navigation pagination-left">
    <ul class="pagination justify-content-center">
      {% if page_obj.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a>
      </li>
      {% else %}
      <li class="page-item disabled">
        <span class="page-link">Previous</span>
      </li>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
      {% if page_obj.number == num %}
      <li class="page-item active"><span class="page-link">{{ num }} <span class="sr-only"></span></span></li>
      {% else %}
      <li class="page-item"><a class="page-link" href="?page={{ num }}">{{ num }}</a></li>
      {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a>
      </li>
      {% else %}
      <li class="page-item disabled">
        <span class="page-link">Next</span>
      </li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %}